<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>gclib: Program Preprocessor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="galil_logo_install_nsis.bmp"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">gclib
   &#160;<span id="projectnumber">366</span>
   </div>
   <div id="projectbrief">Communications API for Galil controllers and PLCs</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('preprocessor.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Program Preprocessor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>gclib's program downloader provides a preprocessor for DMC code. The preprocessor modifies the program prior to download providing a number of language features not present in pure DMC code.</p>
<p>The preprocessor is invoked in the following two ways.</p>
<ol type="1">
<li>With both <a class="el" href="gclib_8h_acafe19b2dd0537ff458e3c8afe3acfeb.html#acafe19b2dd0537ff458e3c8afe3acfeb" title="Downloads a program to the controller&#39;s program buffer. ">GProgramDownload()</a> and <a class="el" href="gclibo_8h_a8e44e2e321df9e7b8c538bf2d640633f.html#a8e44e2e321df9e7b8c538bf2d640633f" title="Program download from file. ">GProgramDownloadFile()</a> via the <code>preprocessor</code> argument. Downloading code with null for the preprocessor argument uses defaults.</li>
<li>From within DMC code via in-band preprocessor directives.</li>
</ol>
<h2>The <code>preprocessor</code> argument</h2>
<p><a class="el" href="gclib_8h_acafe19b2dd0537ff458e3c8afe3acfeb.html#acafe19b2dd0537ff458e3c8afe3acfeb" title="Downloads a program to the controller&#39;s program buffer. ">GProgramDownload()</a> and <a class="el" href="gclibo_8h_a8e44e2e321df9e7b8c538bf2d640633f.html#a8e44e2e321df9e7b8c538bf2d640633f" title="Program download from file. ">GProgramDownloadFile()</a> can be called with a string passed to the <code>preprocessor</code> argument. The program will be modified based on this string prior to download. See <em>Preprocessor Options</em> below for syntax.</p>
<h2>In-band Operation</h2>
<p>DMC code can be written with special markup to signal the preprocessor to take actions prior to download.</p>
<p>For example, the following progam will invoke the in-band preprocessor. The specifics are described below.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;## Author: Zaphod Beeblebrox</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;## Project: Total Perspective Vortex</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;//the above 4 hashmarks enable the preprocessor</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;##option &quot;--min 4&quot; //use a minimum of level four compression</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;REM REM-style comments are supported at all times</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;PRA=1000</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;BGA</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;AMA</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;EN</div>
</div><!-- fragment --><h3>The <code>REM</code> Comment</h3>
<p>Lines beginning with the string <code>REM</code> are removed prior to download. <code>REM</code> comments are always removed regardless of whether the other preprocessor options are enabled or not.</p>
<h3>Double Hash</h3>
<p>Most preprocessor statements begin with a double hash, <code>##</code>. When proceeded by a space, the double hash acts like a <code>REM</code> comment.</p>
<p>When proceeded by a character other than space, <code>##</code> is interpreted as a preprocessor directive. For example, see <code>##option</code> below.</p>
<dl class="section note"><dt>Note</dt><dd>Double hash lines are removed from the program only when the preprocessor is enabled with a quad hash.</dd></dl>
<h3>Quad Hash to enable</h3>
<p>In order to enable the in-band preprocessor, the first two lines of the DMC program must start with a double hash. This syntax of using two lines with double hashmarks is called a <em>quad hash</em>.</p>
<p>Content may follow the hash marks. For example, a good code writing style is to use double hash comments as a comment header showing author, project name, etc.</p>
<h3>C-style comments</h3>
<p>With the preprocessor enabled, C-style comments may be used with the <code>//</code> prefix. These comments are very similar to <code>REM</code> comments. The primary advantage of using this comment over <code>REM</code> is that <code>//</code> comments may occur anywhere in a line. This is helpful for line comments such as the following.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;SIA= 1,25,25,0&lt;4&gt;1 //SSI 25 bits total, all single turn, no status </div>
</div><!-- fragment --><p>Strings containing <code>//</code> are not interpreted as comments.</p>
<dl class="section note"><dt>Note</dt><dd><code>//</code> comments are removed from the program only when the preprocessor is enabled with a quad hash.</dd></dl>
<h3>Preprocessor Directives</h3>
<dl class="section note"><dt>Note</dt><dd>Directives are only followed when the preprocessor is enabled with a quad hash.</dd></dl>
<h4><code>##option</code></h4>
<p>The <code>option</code> directive allows passing switches directly to the preprocessor with the same syntax as the <code>preprocessor</code> argument in <a class="el" href="gclib_8h_acafe19b2dd0537ff458e3c8afe3acfeb.html#acafe19b2dd0537ff458e3c8afe3acfeb" title="Downloads a program to the controller&#39;s program buffer. ">GProgramDownload()</a> and <a class="el" href="gclibo_8h_a8e44e2e321df9e7b8c538bf2d640633f.html#a8e44e2e321df9e7b8c538bf2d640633f" title="Program download from file. ">GProgramDownloadFile()</a>. The syntax of the <code>option</code> directive is the following.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;##option &quot;{preprocessor switches}&quot;</div>
</div><!-- fragment --><p>For example, the following line will disable compression in the program.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;##option &quot;--max 0&quot;</div>
</div><!-- fragment --><p>See <em>Preprocessor Options</em> below for other switches.</p>
<h4><code>##include</code></h4>
<p>The <code>include</code> directive provides a way to include the contents of another DMC file in the current program. This is useful for reusing code such as automatic subroutines, homing operations, or controller initilization routines.</p>
<p>The contents of the file will be inserted in place of the <code>include</code> line. The insertion occurs prior to code compression.</p>
<p>The syntax of the <code>include</code> directive is the following.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;##include &quot;{path to file}&quot;</div>
</div><!-- fragment --><p>For example,</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;##include &quot;c:\galil\initialize.dmc&quot;</div>
</div><!-- fragment --><h3>In-band Support</h3>
<p>In addition to gclib, <a href="http://galil.com/downloads/software/gdk">Galil Design Kit</a> supports the preprocessor. Proper preprocessor usage will be colored in the Editor's syntax highlighter. If the quad hash is not present, preprocessor syntax will be colored differently to indicate inproper usage.</p>
<p>The preprocessor is not supported in software prior to GDK/gclib. DMC code downloads using the in-band preprocessor in prior generation software (e.g. GalilTools or SmartTerm) will fail.</p>
<h2>Preprocessor Options</h2>
<ul>
<li>Lines beginning with <code>REM</code> are always removed from the text prior to download.</li>
<li>A <code>\</code> character on a line other than a preprocessor line will result in an error.</li>
<li>Trailing semicolons are removed.</li>
</ul>
<h3>Compression, <code>--min</code>, <code>--max</code></h3>
<ul>
<li>Defaults<ul>
<li>Use maximum compression, only if needed, to fit the program.</li>
</ul>
</li>
<li><code>--max</code> <em>n</em> provides preprocessing up to and including level <em>n</em>. Only the necessary preprocessing will be performed up to level <em>n</em>.</li>
<li><code>--min</code> <em>n</em> will preprocess at least up to and including <em>n</em>. <em>n</em> defined as with <code>--max</code> above.</li>
</ul>
<h4>Compression Levels, <em>n</em></h4>
<ul>
<li>Level 0 (mandatory)<ol type="1">
<li>Comment blank lines with '.</li>
<li>Remove white space (space/tab) in front of # (label declarations).</li>
<li>Remove white space after commands.</li>
<li>Line ends changed to carriage return.</li>
<li>Replace leading tabs with double space.</li>
<li>Replace non-leading tabs with single space.</li>
</ol>
</li>
<li>Level 1<ol type="1">
<li>Remove unnecessary spaces. Strings, comments ('), and no-ops (NO) are not changed.</li>
</ol>
</li>
<li>Level 2<ol type="1">
<li>Remove comments (') but not no-ops (NO).</li>
</ol>
</li>
<li>Level 3<ol type="1">
<li>Remove no-ops (NO) too.</li>
</ol>
</li>
<li>Level 4<ol type="1">
<li>Break apart compound lines that are too long.</li>
<li>Compact lines of code to maximize line usage.</li>
<li>Use backtick to support long lines where applicable.</li>
</ol>
</li>
</ul>
<h3>Code insertion, <code>--insert</code></h3>
<ul>
<li>Defaults<ul>
<li>Code download begins at line zero and overwrites anything present.</li>
</ul>
</li>
<li><code>--insert</code> <em>arg</em> invokes the insert option of the firmware's <em>DL</em> command. <em>arg</em> can be one of the following.<ol type="1">
<li>Line number, e.g. <code>100</code>. Program insertion will occur on the line after the line specified.</li>
<li>Variable name, e.g. <code>myvar</code>. Program insertion will occur on the line after the line equal to the value of the variable.</li>
<li>Label callout, e.g. <code>#mylabel</code>. Program insertion will occur on the line after the label.</li>
<li>A lone <code>#</code> symbol. Program insertion will occur on the line after the last line in the program buffer.</li>
</ol>
</li>
<li>Compression directives <code>--max</code> and <code>--min</code> are followed.</li>
<li>All original code following the point of insertion is cleared.</li>
<li>Not all products support the <code>--insert</code> operation, e.g. DMC-30010. See the <a href="http://www.galil.com/download/comref/comall/index.html#download.html">DL</a> command for support.</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>It is the user's responsibility to ensure that the code will fit in the inserted location. The preprocessor will not check line numbers when executing the <code>--insert</code> option.</dd></dl>
<h3>Include Search Paths, <code>--search</code>, <code>-I</code></h3>
<ul>
<li>The <code>##include</code> directive will attempt to open its string argument directly. The open will succeed if the argument is the absolute path, or if the argument is in the executable's path, e.g. in the same directory.</li>
<li><code>--search</code> <em>path</em> allows the user to specify a directory or directories to be searched for the <code>include</code> file in case the first open fails.<ul>
<li><code>-I</code> is shorthand for <code>--search</code>.</li>
</ul>
</li>
<li>Multiple directories may be specified with multiple <code>-I</code> directives.</li>
<li>For in-band code, <code>-I</code> must be specified prior to the include.</li>
<li>A common use for <code>-I</code> is to specify only the filename in the DMC source code and use the <code>preprocessor</code> argument during download to specify the path to the files. This allows the files to be moved without a change to source code.</li>
<li>Search order<ol type="1">
<li>The <code>##include</code> argument is checked first as-is.</li>
<li>Then each <code>-I</code> argument in the <code>preprocessor</code> argument, in the order specified.</li>
<li>Then <code>##option</code> directives in the DMC file, in the order specified.</li>
</ol>
</li>
</ul>
<h4>In-band Example</h4>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;##option &quot;-I /code/dmc/homing&quot;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;##option &quot;-I /code/dmc&quot;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;##include &quot;auto.dmc&quot; </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;//executable&#39;s directory will be checked</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;//then c:\code\dmc\homing</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;//then c:\code\dmc</div>
</div><!-- fragment --><h3>Macro Definition, <code>--define</code>, <code>-D</code></h3>
<ul>
<li><code>--define</code> provides a way to substitute one token for another. This is useful for writing code that is generic until program download. Wherever the token is found in code, it is substituted by the replacement. The replacement occurs right before code compression.</li>
<li><code>-D</code> is shorthand for <code>--define</code>.</li>
<li>The token should consist of a starting backslash character, followed by upper or lower case alphanumeric characters, underscores, and an ending backslash.</li>
<li>The common usage for this feature is to write code with a token, and then call the program download with the <code>-D</code> switch.</li>
</ul>
<p>In this example, an axis is defined at download time. Specifing the following for the preprocessor argument</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;--define \ax\:A</div>
</div><!-- fragment --><p>would cause the following code</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;SH\ax\</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;JG\ax\=1000</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;BG\ax\</div>
</div><!-- fragment --><p>to be downloaded as</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;SHA</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;JGA=1000</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;BGA</div>
</div><!-- fragment --><p>This causes the <em>A</em> axis to be addressed.</p>
<h3>GDK Support</h3>
<ul>
<li>See the <code>preprocessor</code> tag in <em>editor.xml</em> to set the desired preprocessor setting for developing in GDK's editor. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
	<li class="footer">Generated by <a href="http://www.galil.com">Galil Motion Control</a></li>
     <!--<li class="footer">Generated by
   <a href="http://www.doxygen.org/index.html">
     <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li> -->
  </ul>
</div>
</body>
</html>
